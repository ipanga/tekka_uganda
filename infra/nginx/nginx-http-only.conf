worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    access_log /var/log/nginx/access.log;

    # ============================================
    # MINIMAL HTTP-ONLY CONFIG FOR SSL BOOTSTRAP
    # No upstreams - only serves ACME challenges
    # ============================================

    server {
        listen 80;
        server_name tekka.ug www.tekka.ug api.tekka.ug admin.tekka.ug;

        # ACME challenge for Let's Encrypt
        location /.well-known/acme-challenge/ {
            root /var/www/certbot;
        }

        # Return info for all other requests
        location / {
            default_type text/plain;
            return 200 'Tekka - SSL Bootstrap Mode\n\nThis server is waiting for SSL certificates.\nRun Certbot to obtain certificates, then restart Nginx.\n';
        }
    }

    # Default server - health check + reject unknown hosts
    server {
        listen 80 default_server;
        server_name _;

        # Health check endpoint for Docker
        location /health {
            access_log off;
            return 200 'OK';
        }

        # Reject all other requests to unknown hosts
        location / {
            return 444;
        }
    }
}
